"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var find = require("find");
var fileinfo = require("filenameinfo");
var Promise = require("bluebird");
var async = require("async");
var getDuration = require('get-video-duration');
var ffmetadata = require("ffmetadata");
function list(path, config) {
    return new Promise(function (resolve, reject) {
        find.file(path, function (files) {
            var media = [];
            for (var i = 0; i < files.length; i++) {
                console.log(files[i]);
                var m = fileinfo.filenameinfo(files[i]);
                if (m.extensionFamily === 'video' || m.extensionFamily === 'audio') {
                    media.push(m);
                }
            }
            async.eachSeries(media, function (m, cb) {
                getDuration(m.path).then(function (a) {
                    m.duration = a;
                    ffmetadata.read(m.path, function (err, data) {
                        if (err) {
                            cb("Error reading metadata");
                        }
                        else {
                            m.meta = data;
                            cb();
                        }
                        ;
                    });
                }).catch(function (err) {
                    cb(err);
                });
            }, function (err) {
                if (err) {
                    reject(err);
                }
                else {
                    resolve(media);
                }
            });
        });
    });
}
exports.list = list;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQTRCO0FBQzVCLHVDQUF3QztBQUN4QyxrQ0FBbUM7QUFDbkMsNkJBQThCO0FBRTlCLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2xELElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQXFCekMsY0FBcUIsSUFBWSxFQUFFLE1BQTJCO0lBQzFELE1BQU0sQ0FBQyxJQUFJLE9BQU8sQ0FBbUIsVUFBQyxPQUFPLEVBQUUsTUFBTTtRQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxVQUFVLEtBQUs7WUFHM0IsSUFBTSxLQUFLLEdBQXFCLEVBQUUsQ0FBQTtZQUlsQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDckIsSUFBTSxDQUFDLEdBQVEsUUFBUSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDOUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGVBQWUsS0FBSyxPQUFPLElBQUksQ0FBQyxDQUFDLGVBQWUsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUNqRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUVqQixDQUFDO1lBRUwsQ0FBQztZQUlELEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLFVBQUMsQ0FBQyxFQUFFLEVBQUU7Z0JBQzFCLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQztvQkFDdkIsQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUE7b0JBQ2QsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLFVBQVUsR0FBRyxFQUFFLElBQUk7d0JBQ3ZDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7NEJBQ04sRUFBRSxDQUFDLHdCQUF3QixDQUFDLENBQUE7d0JBQ2hDLENBQUM7d0JBQUMsSUFBSSxDQUFDLENBQUM7NEJBQ0osQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7NEJBQ2IsRUFBRSxFQUFFLENBQUE7d0JBQ1IsQ0FBQzt3QkFBQSxDQUFDO29CQUNOLENBQUMsQ0FBQyxDQUFDO2dCQUVQLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUc7b0JBQ1QsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUNYLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxFQUFFLFVBQUMsR0FBRztnQkFDSCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDZixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNKLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtnQkFDbEIsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFBO1FBSU4sQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDLENBQUMsQ0FBQTtBQUlOLENBQUM7QUFuREQsb0JBbURDIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZmluZCBmcm9tICdmaW5kJ1xuaW1wb3J0ICogYXMgZmlsZWluZm8gZnJvbSAnZmlsZW5hbWVpbmZvJ1xuaW1wb3J0ICogYXMgUHJvbWlzZSBmcm9tICdibHVlYmlyZCdcbmltcG9ydCAqIGFzIGFzeW5jIGZyb20gJ2FzeW5jJ1xuXG5jb25zdCBnZXREdXJhdGlvbiA9IHJlcXVpcmUoJ2dldC12aWRlby1kdXJhdGlvbicpO1xuY29uc3QgZmZtZXRhZGF0YSA9IHJlcXVpcmUoXCJmZm1ldGFkYXRhXCIpO1xuXG5cbmludGVyZmFjZSBJTWVkaWFGaWxlSW5mb0NvbmYge1xuICAgIGZvcm1hdHM/OiBzdHJpbmdbXVxuICAgIGV4Y2x1ZGU/OiBzdHJpbmdbXVxufVxuaW50ZXJmYWNlIElNZWRpYUZpbGVSZXNwIHtcbiAgICBtZXRhOiBJTWVkaWFGaWxlTWV0YVxuICAgIGR1cmF0aW9uOiBzdHJpbmdcbiAgICBwYXRoOiBzdHJpbmdcbiAgICBmdWxsbmFtZTogc3RyaW5nXG4gICAgbmFtZTogc3RyaW5nXG4gICAgZXh0ZW5zaW9uOiBzdHJpbmdcbiAgICBkaXI6IHN0cmluZ1xuICAgIGV4dGVuc2lvbkZhbWlseTogc3RyaW5nXG4gICAgZXh0ZW5zaW9uVHlwZTogc3RyaW5nXG59XG5pbnRlcmZhY2UgSU1lZGlhRmlsZU1ldGEge1xuXG59XG5leHBvcnQgZnVuY3Rpb24gbGlzdChwYXRoOiBzdHJpbmcsIGNvbmZpZz86IElNZWRpYUZpbGVJbmZvQ29uZikge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJTWVkaWFGaWxlUmVzcFtdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZpbmQuZmlsZShwYXRoLCBmdW5jdGlvbiAoZmlsZXMpIHtcblxuXG4gICAgICAgICAgICBjb25zdCBtZWRpYTogSU1lZGlhRmlsZVJlc3BbXSA9IFtdXG5cblxuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZmlsZXNbaV0pXG4gICAgICAgICAgICAgICAgY29uc3QgbTogYW55ID0gZmlsZWluZm8uZmlsZW5hbWVpbmZvKGZpbGVzW2ldKVxuICAgICAgICAgICAgICAgIGlmIChtLmV4dGVuc2lvbkZhbWlseSA9PT0gJ3ZpZGVvJyB8fCBtLmV4dGVuc2lvbkZhbWlseSA9PT0gJ2F1ZGlvJykge1xuICAgICAgICAgICAgICAgICAgICBtZWRpYS5wdXNoKG0pXG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgIGFzeW5jLmVhY2hTZXJpZXMobWVkaWEsIChtLCBjYikgPT4ge1xuICAgICAgICAgICAgICAgIGdldER1cmF0aW9uKG0ucGF0aCkudGhlbigoYSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBtLmR1cmF0aW9uID0gYVxuICAgICAgICAgICAgICAgICAgICBmZm1ldGFkYXRhLnJlYWQobS5wYXRoLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IoXCJFcnJvciByZWFkaW5nIG1ldGFkYXRhXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ubWV0YSA9IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYigpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2IoZXJyKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVkaWEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuXG5cbiAgICAgICAgfSlcbiAgICB9KVxuXG5cblxufVxuXG5cbiJdfQ==
